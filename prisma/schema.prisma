generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model IdempotencyKey {
  key          String   @id
  payloadHash  String
  responseBody Json
  statusCode   Int
  createdAt    DateTime @default(now())
}

model WebhookSubscription {
  id        String         @id @default(uuid())
  url       String
  secret    String?
  events    String[]
  createdAt DateTime       @default(now())
  eventsLog WebhookEvent[]
}

model WebhookEvent {
  id             String              @id @default(uuid())
  subscriptionId String
  subscription   WebhookSubscription @relation(fields: [subscriptionId], references: [id])
  eventId        String
  shipmentId     String?
  payload        Json
  status         String              @default("pending") // pending, delivered, failed
  attempts       Int                 @default(0)
  nextAttemptAt  DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
}

model Shipment {
  id         String   @id
  providerId String
  createdAt  DateTime @default(now())
}

